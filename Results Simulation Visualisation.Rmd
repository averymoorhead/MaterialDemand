---
title: "Results Simulation Visualisation"
output: html_notebook
---


```{r}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/avery/OneDrive/Desktop/MaterialDemand/Outputs")

library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales) 
library(patchwork)
library(cowplot)

```

```{r}
setwd("C:/Users/avery/OneDrive/Desktop/MaterialDemand/Outputs")
repeat_materials_demand<- read.csv("repeat_materials_demand.csv")
materials_demand<-read.csv("materials_demand.csv")
transmission_material_sum<-read.csv("transmission_material_sum.csv")
materials_demand <- materials_demand %>%
  mutate(technology = case_when(
    technology == "utility-scale solar pv" ~ "Solar",
    technology == "onshore wind" ~ "Onshore Wind",
    TRUE ~ technology 
  ))
```

```{r}
#data processing 
transmission_for_plot <- transmission_material_sum %>%
  mutate(
    technology = "transmission",  
    Aluminum_mean = Aluminum,     
    Copper_mean = Cu,            
    Steel_mean = Steel,          
    Cement_mean = Cement,         
    Glass_mean = Glass,
    scenario = if_else(scenario == "REF", "Ref", scenario)  
  ) %>%
  select(-Aluminum, -Cu, -Steel, -Cement,-Glass)  

missing_columns <- setdiff(names(repeat_materials_demand), names(transmission_for_plot))

for (col in missing_columns) {
  if (!col %in% names(transmission_for_plot)) {
    transmission_for_plot[[col]] <- 0
  }
}

repeat_materials_demand<-rbind(transmission_for_plot,repeat_materials_demand)
missing_columns <- setdiff(names(repeat_materials_demand), names(transmission_for_plot))
missing_columns <- setdiff(names(transmission_for_plot), names(repeat_materials_demand))


```

```{r}
# plot_df <- subset(materials_demand, select = c('scenario', 'year', 'technology', 'Aluminum_mean'))
# trans_plot_df<- subset(transmission_material_sum, select = c('scenario', 'year', 'Aluminum'))
# trans_plot_df <- trans_plot_df %>%
#   mutate(technology = "transmission") %>%
#   rename(Aluminum_mean = Aluminum)
# plot_df <- rbind(plot_df, trans_plot_df)
# 
# plot_df <- subset(plot_df, scenario == "IRA" | is.na(scenario))
# plot_df <- plot_df %>%
#   filter(scenario == "IRA")
# plot_df <- plot_df %>%
#   mutate(
#     technology = case_when(
#       technology == "Nuclear New" ~ "Nuclear",
#       technology == "onshore wind" ~ "Wind",
#       technology == "offshore wind" ~ "Offshore Wind",
#       technology == "transmission" ~ "Transmission",
#       technology == "Solar" ~ "Solar",
#       TRUE ~ technology
#     )
#   )
# 
# repeat_materials_demand <- repeat_materials_demand %>% 
#   mutate(
#     scenario = case_when(
#       scenario == "REF" ~ "Ref",
#       TRUE ~ scenario
#     )
#   )
# 
# plot_df$year <- as.integer(plot_df$year)
# 
# 
# # Create the plot
# ggplot(plot_df, aes(x = year, y = Aluminum_mean, fill = technology)) +
#   geom_area() +
#   labs(title = "IRA Aluminum Material Demand",
#        x = "Year",
#        y = "Material Demand") +
#   theme_minimal() +
#   scale_y_continuous(labels = comma) +  # Format y-axis labels without scientific notation
#   scale_x_continuous(breaks = c(2025, 2030, 2035))  # Set specific x-axis breaks

```


```{r}
#data processing 
materials_demand <- materials_demand %>%
  mutate(
    technology = case_when(
      technology == "Nuclear New" ~ "Nuclear",
      technology == "onshore wind" ~ "Onshore Wind",
      technology == "offshore wind" ~ "Offshore Wind",
      technology == "transmission" ~ "Transmission",
      technology == "utility-scale solar pv" ~ "Solar",
      TRUE ~ technology
    )
  )

repeat_materials_demand <- repeat_materials_demand %>%
  mutate(
    technology = case_when(
      technology == "Nuclear New" ~ "Nuclear",
      technology == "onshore wind" ~ "Onshore Wind",
      technology == "offshore wind" ~ "Offshore Wind",
      technology == "transmission" ~ "Transmission",
      technology == "utility-scale solar pv" ~ "Solar",
      TRUE ~ technology
    )
  )


```


**Jenkins et al. (2023) plot, Reference scenario **
```{r}
tech_colors <- c(
                 "Gas" = "#C49A00", 
                 "Nuclear" = "#00C094", 
                 "Offshore Wind" = "#EA8331",  
                 "Transmission" = "#A58AFF", 
                 "Solar" = "#FB61D7",
                 "Onshore Wind" = "#00B6EB")

materials <- c("Aluminum", "Boron",  "Cement", "Chromium", "Copper", "Dysprosium", "Fiberglass", "Glass", "Lead", "Magnesium", "Manganese","Molybdenum","Neodymium", "Nickel", "Niobium", "Praseodymium",  "Silicon", "Silver", "Steel",  "Terbium", "Tin", "Vanadium", "Yttrium", "Zinc")

plot_list <- list()

# Loop through each material
for (material in materials) {
  plot_df <- subset(repeat_materials_demand, scenario == "Ref", select = c('year', 'technology', paste0(material, "_mean")))
  
  plot_df$year <- as.integer(plot_df$year)
  
  p <- ggplot(plot_df, aes(x = year, y = !!sym(paste0(material, "_mean")), fill = technology)) +
    geom_area() +
    labs(title = paste(material),
         x = "",
         y = "") +
    theme_minimal() +
    scale_y_continuous(labels = comma) +  
    scale_x_continuous(breaks = c(2025, 2030, 2035)) +  
    theme(
      legend.position = "none", 
             axis.text.x = element_text(size = 14),
      axis.text.y = element_text(size = 14), 
      axis.title.x = element_text(size = 16), 
      axis.title.y = element_text(size = 16), 
      plot.title = element_text(size = 20, hjust = 0.5)
    ) +
    scale_fill_manual(values = tech_colors) 
    plot_list[[material]] <- p
}

combined_plot <- cowplot::plot_grid(plotlist = plot_list, ncol = 5, align = "h", rel_widths = rep(1, length(materials)))

legend_plot <- cowplot::get_legend(plot_list[["Aluminum"]] + theme(legend.position = "right"))

final_plot <- cowplot::ggdraw() +
  cowplot::draw_plot(combined_plot, 0, 0, 0.8, 1) +
  cowplot::draw_plot(legend_plot, 0.8, 0, 0.2, 1)

print(final_plot)

plot_width <- 10 

final_plot_with_title <- wrap_plots(plotlist = plot_list, ncol = 3, widths = rep(plot_width, length(plot_list)))

common_y_axis_title <- ggdraw() +
  draw_label("Thousand Metric Tonnes/year", angle = 90, size = 20, hjust = 0.5, vjust = 0.5) +
  theme(plot.margin = margin(5.5, 5.5, 5.5, 0, "pt"))

final_plot_with_title <- cowplot::plot_grid(
  common_y_axis_title,
  final_plot_with_title + theme(plot.margin = margin(5.5, 0, 5.5, 5.5, "pt")),
  nrow = 1,
  rel_widths = c(0.1, 0.9)
)
ggsave("repeatresultsplotREF.jpg", plot = final_plot_with_title, width = 13.5, height = 15, units = "in", dpi = 300)

```
**Jenkins et al. (2023) plot, IRA scenario **
```{r}
tech_colors <- c(
  "Gas" = "#C49A00",
  "Nuclear" = "#00C094",
  "Offshore Wind" = "#EA8331",  
  "Transmission" = "#A58AFF",
  "Solar" = "#FB61D7",
  "Onshore Wind" = "#00B6EB"
)

plot_list <- list()

for (material in materials) {
  plot_df <- subset(repeat_materials_demand, scenario == "IRA", select = c('year', 'technology', paste0(material, "_mean")))

  plot_df$year <- as.integer(plot_df$year)
  
  unique_technologies <- unique(plot_df$technology)

  p <- ggplot(plot_df, aes(x = year, y = !!sym(paste0(material, "_mean")), fill = technology)) +
    geom_area() +
    labs(title = paste(material),
         x = "",
         y = "") +
    theme_minimal() +
    scale_y_continuous(labels = comma) + 
    scale_x_continuous(breaks = c(2025, 2030, 2035)) +  
    theme(
      legend.position = "none", 
      axis.text.x = element_text(size = 14),
      axis.text.y = element_text(size = 14), 
      axis.title.x = element_text(size = 16), 
      axis.title.y = element_text(size = 16),
      plot.title = element_text(size = 20, hjust = 0.5)  
    ) +
    scale_fill_manual(values = tech_colors)  

  plot_list[[material]] <- p
}

combined_plot <- cowplot::plot_grid(plotlist = plot_list, ncol = 5, align = "h", rel_widths = rep(1, length(materials)))

legend_plot <- cowplot::get_legend(plot_list[["Aluminum"]] + theme(legend.position = "right"))

final_plot <- cowplot::ggdraw() +
  cowplot::draw_plot(combined_plot, 0, 0, 0.8, 1) +
  cowplot::draw_plot(legend_plot, 0.8, 0, 0.2, 1)

print(final_plot)

plot_width <- 10 

final_plot_with_title <- wrap_plots(plotlist = plot_list, ncol = 3, widths = rep(plot_width, length(plot_list)))

common_y_axis_title <- ggdraw() +
  draw_label("Thousand Metric Tonnes/year", angle = 90, size = 20, hjust = 0.5, vjust = 0.5) +
  theme(plot.margin = margin(5.5, 5.5, 5.5, 0, "pt"))

final_plot_with_title <- cowplot::plot_grid(
  common_y_axis_title,
  final_plot_with_title + theme(plot.margin = margin(5.5, 0, 5.5, 5.5, "pt")),
  nrow = 1,
  rel_widths = c(0.1, 0.9)
)

print(final_plot_with_title)
ggsave("repeatresultsplotIRA.jpg", plot = final_plot_with_title, width = 13.5, height = 15, units = "in", dpi = 300)


```
**Bistline et al (2023) plot, reference scenario **

```{r}

tech_colors <- c("Biomass" = "#d3d3d3",

                "Coal" = "#F8766D", 
                 "Gas" = "#C49A00", 
                 "Hydro" = "#53B400", 
                 "Nuclear" = "#00C094", 
                 "Offshore Wind" = "#EA8331",  
                 "Transmission" = "#A58AFF", 
                 "Solar" = "#FB61D7",
                 "Onshore Wind" = "#00B6EB")

plot_list <- list()

for (material in materials) {
  plot_df <- subset(materials_demand, scenario == "Ref", select = c('year', 'technology', paste0(material, "_mean")))

  plot_df$year <- as.integer(plot_df$year)
  
  p <- ggplot(plot_df, aes(x = year, y = !!sym(paste0(material, "_mean")), fill = technology)) +
    geom_area() +
    labs(title = paste(material),
         x = "",
         y = "") +
    theme_minimal() +
    scale_y_continuous(labels = comma) +  
    scale_x_continuous(breaks = c(2025, 2030, 2035)) + 
    theme(
      legend.position = "none",  
      axis.text.x = element_text(size = 14),
      axis.text.y = element_text(size = 14), 
      axis.title.x = element_text(size = 16), 
      axis.title.y = element_text(size = 16), 
      plot.title = element_text(size = 20, hjust = 0.5)
    ) +
    scale_fill_manual(values = tech_colors)  
  
  plot_list[[material]] <- p
}

combined_plot <- cowplot::plot_grid(plotlist = plot_list, ncol = 5, align = "h", rel_widths = rep(1, length(materials)))

legend_plot <- cowplot::get_legend(plot_list[["Nickel"]] + theme(legend.position = "right"))

final_plot <- cowplot::ggdraw() +
  cowplot::draw_plot(combined_plot, 0, 0, 0.8, 1) +
  cowplot::draw_plot(legend_plot, 0.8, 0, 0.2, 1)

print(final_plot)


plot_width <- 10  

final_plot_with_title <- wrap_plots(plotlist = plot_list, ncol = 3, widths = rep(plot_width, length(plot_list)))

common_y_axis_title <- ggdraw() +
  draw_label("Thousand Metric Tonnes/year", angle = 90, size = 20, hjust = 0.5, vjust = 0.5) +
  theme(plot.margin = margin(5.5, 5.5, 5.5, 0, "pt"))

final_plot_with_title <- cowplot::plot_grid(
  common_y_axis_title,
  final_plot_with_title + theme(plot.margin = margin(5.5, 0, 5.5, 5.5, "pt")),
  nrow = 1,
  rel_widths = c(0.1, 0.9)
)

print(final_plot_with_title)
print(getwd())
ggsave("multimodelresultsplotREF.jpg", plot = final_plot_with_title, width = 13, height = 15, units = "in", dpi = 300)

```
**Bistline et al (2023) plot, IRA scenario **

```{r}
tech_colors <- c("Biomass" = "#d3d3d3",
  "Coal" = "#F8766D", 
                 "Gas" = "#C49A00", 
                 "Hydro" = "#53B400", 
                 "Nuclear" = "#00C094", 
                 "Offshore Wind" = "#EA8331", 
                 "Transmission" = "#A58AFF", 
                 "Solar" = "#FB61D7",
                 "Onshore Wind" = "#00B6EB")

plot_list <- list()

for (material in materials) {
  plot_df <- subset(materials_demand, scenario == "IRA", select = c('year', 'technology', paste0(material, "_mean")))

  plot_df$year <- as.integer(plot_df$year)
  
  p <- ggplot(plot_df, aes(x = year, y = !!sym(paste0(material, "_mean")), fill = technology)) +
    geom_area() +
    labs(title = paste(material),
         x = "",
         y = "") +
    theme_minimal() +
    scale_y_continuous(labels = comma) +  
    scale_x_continuous(breaks = c(2025, 2030, 2035)) +  
    theme(
      legend.position = "none",  
       axis.text.x = element_text(size = 1),
      axis.text.y = element_text(size = 1), 
      axis.title.x = element_text(size = 1), 
      axis.title.y = element_text(size = 1),
      plot.title = element_text(size = 2, hjust = 0.5)
    ) +
    scale_fill_manual(values = tech_colors)  
  
  plot_list[[material]] <- p
}

combined_plot <- cowplot::plot_grid(plotlist = plot_list, ncol = 5, align = "h", rel_widths = rep(1, length(materials)))

legend_plot <- cowplot::get_legend(plot_list[["Nickel"]] + theme(legend.position = "right"))

final_plot <- cowplot::ggdraw() +
  cowplot::draw_plot(combined_plot, 0, 0, 0.8, 1) +
  cowplot::draw_plot(legend_plot, 0.8, 0, 0.2, 1)

print(final_plot)

plot_width <- 10  

final_plot_with_title <- wrap_plots(plotlist = plot_list, ncol = 3, widths = rep(plot_width, length(plot_list)))

common_y_axis_title <- ggdraw() +
  draw_label("Thousand Metric Tonnes/year", angle = 90, size = 20, hjust = 0.5, vjust = 0.5) +
  theme(plot.margin = margin(5.5, 5.5, 5.5, 0, "pt"))

final_plot_with_title <- cowplot::plot_grid(
  common_y_axis_title,
  final_plot_with_title + theme(plot.margin = margin(5.5, 0, 5.5, 5.5, "pt")),
  nrow = 1,
  rel_widths = c(0.1, 0.9)
)

print(final_plot_with_title)
print(getwd())
ggsave("multimodelresultsplotIRA.jpg", plot = final_plot_with_title, width = 12, height = 15, units = "in", dpi = 300)

```

